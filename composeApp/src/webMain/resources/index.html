<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mio Pages</title>
    <link type="text/css" rel="stylesheet" href="styles.css">
    <style>
        /* 1. 基础背景设置：深色模式更显酷炫 */
        body {
            background-color: #1e1e1e; /* 与你的 App 主题色保持一致，避免闪屏 */
            margin: 0;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        /* 2. 加载容器 */
        #loading-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: #1e1e1e;
            z-index: 9999;
            transition: opacity 0.8s ease-in-out; /* 过渡效果核心 */
        }

        /* 3. 酷炫的呼吸光环动画 */
        .loader {
            position: relative;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(45deg, transparent, transparent 40%, #e5f403);
            animation: rotate 2s linear infinite;
        }

        .loader::before {
            content: "";
            position: absolute;
            top: 6px;
            left: 6px;
            bottom: 6px;
            right: 6px;
            background: #1e1e1e;
            border-radius: 50%;
            z-index: 1000;
        }

        .loader::after {
            content: "";
            position: absolute;
            top: 0px;
            left: 0px;
            bottom: 0px;
            right: 0px;
            background: linear-gradient(45deg, transparent, transparent 40%, #e5f403);
            border-radius: 50%;
            z-index: 1;
            filter: blur(30px); /* 发光效果 */
            animation: rotate 2s linear infinite;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); filter: hue-rotate(0deg); }
            100% { transform: rotate(360deg); filter: hue-rotate(360deg); }
        }

        .loading-text {
            margin-top: 20px;
            color: #fff;
            font-family: monospace;
            font-size: 1.2rem;
            letter-spacing: 2px;
            animation: blink 1.5s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* 4. 状态类：控制显示与隐藏 */
        .fade-out {
            opacity: 0;
            pointer-events: none; /* 防止消失后挡住点击 */
        }

        /* Compose 的 Canvas 默认 ID 通常没有，但它是页面唯一的 Canvas */
        canvas {
            opacity: 0; /* 初始隐藏 Canvas */
            transition: opacity 0.8s ease-in-out;
        }

        canvas.fade-in {
            opacity: 1; /* 加载完成后显示 */
        }
    </style>
</head>
<body>

<div id="loading-container">
    <div class="loader"></div>
    <div class="loading-text">加载中...</div>
</div>

<script>
    // 使用 MutationObserver 监听 body 变化，等待 Canvas 出现
    const observer = new MutationObserver((mutations) => {
        for (const mutation of mutations) {
            for (const node of mutation.addedNodes) {
                // Compose Wasm 通常会创建一个 Canvas 元素
                if (node.tagName === 'CANVAS') {
                    const canvas = node;
                    const loader = document.getElementById('loading-container');

                    // 稍微延迟一点点，确保 Canvas 已经渲染了第一帧（可选）
                    setTimeout(() => {
                        loader.classList.add('fade-out');
                        canvas.classList.add('fade-in');

                        // 动画结束后移除 DOM 节点，节省资源
                        setTimeout(() => {
                            loader.remove();
                        }, 1000);
                    }, 100);

                    observer.disconnect(); // 停止监听
                }
            }
        }
    });

    observer.observe(document.body, { childList: true });
</script>

<script type="application/javascript" src="composeApp.js"></script>

</body>
</html>